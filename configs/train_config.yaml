# ClearPixAI Training Configuration
# This config file ensures reproducibility and allows easy experimentation

# Project metadata
project:
  name: "clearpixai_watermark_detector"
  description: "Watermark detection model using segmentation"
  version: "1.0.0"

# Random seed for reproducibility
random_seed: 42

# Data configuration
data:
  # Path to training data directory
  # Expected structure:
  #   data_dir/
  #   ├── clean/          # Clean images without watermarks
  #   └── watermarked/    # Images with watermarks
  data_dir: "clearpixai/training/detector/data/train"
  
  # Image preprocessing
  image_size: 512  # Target size for training (square)
  
  # Data split
  val_split: 0.2  # Validation set ratio
  
  # Data loading
  batch_size: 4
  num_workers: 4
  pin_memory: true
  
  # Optional: limit number of samples for debugging
  max_samples: null  # Set to integer to limit dataset size

# Model architecture
model:
  # Encoder backbone (from segmentation_models_pytorch)
  encoder_name: "mit_b5"  # Options: resnet34, resnet50, efficientnet-b0, mit_b5, etc.
  
  # Pretrained encoder weights
  encoder_weights: "imagenet"  # Options: imagenet, null (random init)
  
  # Model structure
  in_channels: 3
  classes: 1  # Binary segmentation (watermark vs background)
  
  # Loss function
  loss_fn: "combined"  # Options: dice, bce, combined

# Training configuration
training:
  # Optimizer
  learning_rate: 0.0001  # 1e-4
  
  # Training duration
  max_epochs: 1
  
  # Early stopping
  early_stopping:
    enabled: true
    patience: 15
    monitor: "val_iou"
    mode: "max"
  
  # Learning rate scheduler
  lr_scheduler:
    enabled: true
    type: "reduce_on_plateau"  # ReduceLROnPlateau
    monitor: "val_iou"
    mode: "max"
    factor: 0.5
    patience: 5
  
  # Checkpointing
  checkpoint:
    save_top_k: 3
    monitor: "val_iou"
    mode: "max"
    filename: "watermark-{epoch:02d}-{val_iou:.4f}"
    save_last: true

# Transfer learning / Finetuning
pretrained:
  # Path to pretrained weights for finetuning
  weights_path: "clearpixai/detection/best_watermark_model_mit_b5_best.pth"
  
  # Set to false to train from scratch
  use_pretrained: true

# Hardware configuration
hardware:
  accelerator: "auto"  # Options: auto, gpu, cpu, mps
  devices: 1  # Number of devices or specific device IDs [0, 1]
  precision: 32  # Options: 32, 16, bf16
  
  # Specific GPU selection (optional)
  gpu_id: null  # Set to specific GPU ID (e.g., 0, 1, 5) or null for default

# Output configuration
output:
  # Directory for saving checkpoints and logs
  checkpoint_dir: "checkpoints"
  
  # TensorBoard logging
  tensorboard:
    enabled: true
    save_dir: "checkpoints"
    name: "watermark_detection"
  
  # Logging frequency
  log_every_n_steps: 10
  val_check_interval: 1.0  # Validate after every epoch

# Augmentation configuration
augmentation:
  # Training augmentations
  train:
    horizontal_flip: 0.5
    vertical_flip: 0.5
    random_rotate_90: 0.5
    shift_scale_rotate:
      shift_limit: 0.0625
      scale_limit: 0.1
      rotate_limit: 15
      p: 0.5
    elastic_transform: 0.3
    gaussian_noise: 0.3
    brightness_contrast: 0.3
  
  # Normalization (ImageNet stats)
  normalize:
    mean: [0.485, 0.456, 0.406]
    std: [0.229, 0.224, 0.225]

